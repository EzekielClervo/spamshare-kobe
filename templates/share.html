{% extends 'base.html' %}

{% block title %}SpamShare - Facebook Auto Sharer{% endblock %}

{% block extra_head %}
<style>
  /* Retro cyberpunk theme with box aesthetic */
  :root {
    --neon-pink: #ff00ff;
    --neon-blue: #00ffff;
    --neon-purple: #8A2BE2;
    --dark-bg: #121212;
    --darker-bg: #0a0a0a;
    --box-border: 2px solid var(--neon-blue);
    --box-shadow: 0 0 10px var(--neon-blue), 0 0 20px rgba(0, 255, 255, 0.2);
  }
  
  body {
    background-color: var(--dark-bg) !important;
  }
  
  .cyber-box {
    background: rgba(10, 10, 15, 0.8);
    border: var(--box-border);
    box-shadow: var(--box-shadow);
    border-radius: 5px;
    padding: 20px;
    position: relative;
    overflow: hidden;
  }
  
  .cyber-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue), var(--neon-purple));
    z-index: 1;
  }
  
  .cyber-header {
    font-family: 'Courier New', monospace;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--neon-blue);
    text-shadow: 0 0 5px var(--neon-blue);
    border-bottom: 1px solid var(--neon-blue);
    padding-bottom: 10px;
    margin-bottom: 20px;
  }
  
  /* Console-like results container */
  .console-container {
    background: #000;
    color: #0f0;
    font-family: 'Courier New', monospace;
    padding: 10px;
    border: 1px solid var(--neon-blue);
    max-height: 300px;
    overflow-y: auto;
    margin-top: 20px;
  }
  
  .console-line {
    padding: 3px 0;
    position: relative;
    border-bottom: 1px solid rgba(0, 255, 255, 0.1);
  }
  
  .share-success {
    color: #0f0;
  }
  
  .share-error {
    color: #f00;
  }
  
  /* Progress indicators */
  .progress-container {
    background: #000;
    border: 1px solid var(--neon-blue);
    margin: 20px 0;
    position: relative;
    height: 30px;
    overflow: hidden;
  }
  
  .progress-bar {
    background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
    height: 100%;
    width: 0%;
    transition: width 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, 
                                transparent, 
                                rgba(255, 255, 255, 0.2), 
                                transparent);
    animation: progress-shine 1.5s infinite;
  }
  
  @keyframes progress-shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  .progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-family: 'Courier New', monospace;
    text-shadow: 0 0 5px black;
    z-index: 1;
  }
  
  /* Terminal-like blinking cursor */
  .blink-cursor {
    animation: blink 1s step-end infinite;
  }
  
  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
  
  /* Status message styling */
  #statusMessage {
    font-family: 'Courier New', monospace;
    font-size: 14px;
    color: var(--neon-blue);
    margin: 10px 0;
  }
  
  /* Form labels */
  label {
    color: var(--neon-blue);
    font-family: 'Courier New', monospace;
    text-transform: uppercase;
    font-size: 0.9rem;
    letter-spacing: 1px;
  }
  
  /* Form styling */
  .form-control {
    background-color: rgba(0, 0, 0, 0.7) !important;
    border: 1px solid var(--neon-blue) !important;
    color: white !important;
    font-family: 'Courier New', monospace;
  }
  
  .form-control:focus {
    box-shadow: 0 0 10px var(--neon-blue) !important;
  }
  
  /* Neon button */
  .neon-button {
    background: transparent;
    color: var(--neon-blue);
    border: 1px solid var(--neon-blue);
    padding: 10px 20px;
    font-family: 'Courier New', monospace;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 0 10px var(--neon-blue);
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    margin-top: 20px;
  }
  
  .neon-button:hover {
    background-color: rgba(0, 255, 255, 0.1);
    box-shadow: 0 0 20px var(--neon-blue);
    color: white;
  }
  
  /* Tab styling */
  .cyber-tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--neon-blue);
  }
  
  .tab-btn {
    background: transparent;
    color: var(--neon-blue);
    border: 1px solid var(--neon-blue);
    border-bottom: none;
    padding: 10px 20px;
    font-family: 'Courier New', monospace;
    text-transform: uppercase;
    margin-right: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .tab-btn.active {
    background-color: rgba(0, 255, 255, 0.1);
    color: white;
    box-shadow: 0 0 10px var(--neon-blue);
  }
  
  .tab-content {
    display: none;
    padding: 20px;
    background-color: rgba(0, 0, 0, 0.7);
    border: 1px solid var(--neon-blue);
    border-top: none;
  }
  
  .tab-content.active {
    display: block;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-md-10 mx-auto text-center mb-4">
      <h1 style="color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); font-family: 'Courier New', monospace; text-transform: uppercase; letter-spacing: 5px;">SPAM<span style="color: var(--neon-pink); text-shadow: 0 0 10px var(--neon-pink);">SHARE</span></h1>
      <p style="color: white; font-family: 'Courier New', monospace;">FACEBOOK AUTO SHARE TOOL</p>
    </div>
    
    <div class="col-md-10 mx-auto">
      <div class="cyber-box">
        <h2 class="cyber-header text-center">FB SHARE ENGINE v1.0</h2>
        
        <!-- Tab Navigation -->
        <div class="cyber-tabs">
          <button class="tab-btn active" onclick="openTab(event, 'cookie-tab')">COOKIE</button>
          <button class="tab-btn" onclick="openTab(event, 'appstate-tab')">APPSTATE</button>
        </div>
        
        <!-- Cookie Tab -->
        <div id="cookie-tab" class="tab-content active">
          <form id="cookie-form">
            <input type="hidden" name="share_type" value="cookie">
            
            <div class="mb-3">
              <label for="cookie">FACEBOOK COOKIE</label>
              <textarea id="cookie" name="cookie" class="form-control" rows="4" placeholder="PASTE COOKIE HERE" required></textarea>
            </div>
            
            <div class="mb-3">
              <label for="post_url_cookie">POST URL</label>
              <input type="url" id="post_url_cookie" name="post_url" class="form-control" placeholder="https://www.facebook.com/..." required>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="count_cookie">SHARE COUNT</label>
                  <input type="number" id="count_cookie" name="count" class="form-control" min="1" max="50000" value="3" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="delay_cookie">DELAY (SECONDS)</label>
                  <input type="number" id="delay_cookie" name="delay" class="form-control" min="0" max="60" value="0" required>
                </div>
              </div>
            </div>
            
            <button type="submit" class="neon-button w-100">INITIATE SHARE SEQUENCE</button>
          </form>
        </div>
        
        <!-- Appstate Tab -->
        <div id="appstate-tab" class="tab-content">
          <form id="appstate-form">
            <input type="hidden" name="share_type" value="appstate">
            
            <div class="mb-3">
              <label for="appstate">APPSTATE JSON</label>
              <textarea id="appstate" name="appstate" class="form-control" rows="4" placeholder="PASTE APPSTATE JSON HERE" required></textarea>
            </div>
            
            <div class="mb-3">
              <label for="post_url_appstate">POST URL</label>
              <input type="url" id="post_url_appstate" name="post_url" class="form-control" placeholder="https://www.facebook.com/..." required>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="count_appstate">SHARE COUNT</label>
                  <input type="number" id="count_appstate" name="count" class="form-control" min="1" max="50000" value="3" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="delay_appstate">DELAY (SECONDS)</label>
                  <input type="number" id="delay_appstate" name="delay" class="form-control" min="0" max="60" value="0" required>
                </div>
              </div>
            </div>
            
            <button type="submit" class="neon-button w-100">INITIATE SHARE SEQUENCE</button>
          </form>
        </div>
        
        <!-- Console Output Section -->
        <div id="console-section" style="display: none;" class="mt-4">
          <h4 class="cyber-header">SYSTEM OUTPUT <span class="blink-cursor">_</span></h4>
          
          <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
            <div id="progress-text" class="progress-text">0%</div>
          </div>
          
          <div id="statusMessage" class="mb-2">SYSTEM READY</div>
          
          <div id="console-container" class="console-container">
            <div class="console-line">
              > SPAMSHARE v1.0 INITIALIZED...
            </div>
            <div class="console-line">
              > AWAITING USER INPUT...
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Tab switching functionality
  function openTab(evt, tabName) {
    // Hide all tab content
    var tabcontent = document.getElementsByClassName("tab-content");
    for (var i = 0; i < tabcontent.length; i++) {
      tabcontent[i].classList.remove("active");
    }
    
    // Remove active class from all tab buttons
    var tablinks = document.getElementsByClassName("tab-btn");
    for (var i = 0; i < tablinks.length; i++) {
      tablinks[i].classList.remove("active");
    }
    
    // Show the current tab and add an "active" class to the button
    document.getElementById(tabName).classList.add("active");
    evt.currentTarget.classList.add("active");
  }

  document.addEventListener('DOMContentLoaded', function() {
    // Form submission handlers
    const forms = [
      { id: 'cookie-form', type: 'cookie' },
      { id: 'appstate-form', type: 'appstate' }
    ];
    
    forms.forEach(form => {
      const formElement = document.getElementById(form.id);
      
      formElement.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Show console section
        document.getElementById('console-section').style.display = 'block';
        
        // Add initialization message to console
        const consoleContainer = document.getElementById('console-container');
        consoleContainer.innerHTML = ''; // Clear previous results
        
        addConsoleMessage('> VALIDATING INPUT PARAMETERS...', 'normal');
        addConsoleMessage('> ESTABLISHING CONNECTION...', 'normal');
        
        // Get form data
        const formData = new FormData(formElement);
        
        // Update status message
        document.getElementById('statusMessage').textContent = 'CONNECTING TO FACEBOOK SERVERS...';
        
        // Disable form button
        const submitButton = formElement.querySelector('button[type="submit"]');
        const originalButtonText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = 'PROCESSING REQUEST...';
        
        // Reset progress bar
        document.getElementById('progress-bar').style.width = '0%';
        document.getElementById('progress-text').textContent = '0%';
        
        // Simulate connection delay for better UX
        setTimeout(() => {
          addConsoleMessage('> CONNECTION ESTABLISHED', 'normal');
          addConsoleMessage('> INITIATING SHARE SEQUENCE...', 'normal');
          
          // Send AJAX request
          fetch('/share', {
            method: 'POST',
            body: formData
          })
          .then(response => {
            // Check if response is valid JSON
            if (!response.ok) {
              throw new Error(`Server responded with ${response.status}: ${response.statusText}`);
            }
            return response.json();
          })
          .then(data => {
            const count = parseInt(formData.get('count'));
            const percentage = data.success_count > 0 ? (data.success_count / count) * 100 : 0;
            
            // Update progress bar
            document.getElementById('progress-bar').style.width = `${percentage}%`;
            document.getElementById('progress-text').textContent = `${Math.round(percentage)}%`;
            
            // Update status message
            if (data.success_count > 0) {
              document.getElementById('statusMessage').textContent = `OPERATION COMPLETED: ${data.success_count}/${count} SHARES SUCCESSFUL`;
            } else {
              document.getElementById('statusMessage').textContent = 'OPERATION FAILED';
            }
            
            // Display results in console format
            if (data.results && data.results.length > 0) {
              data.results.forEach((result) => {
                if (result.status === 'progress' || result.status === 'success') {
                  addConsoleMessage(`> ${result.message}`, 'share-success');
                } else if (result.status === 'error') {
                  addConsoleMessage(`> ERROR: ${result.message}`, 'share-error');
                }
              });
              
              if (data.success_count > 0) {
                addConsoleMessage(`> SHARE OPERATION COMPLETE - ${data.success_count}/${count} SUCCESSFUL`, 'normal');
              }
            } else if (data.message) {
              addConsoleMessage(`> ERROR: ${data.message}`, 'share-error');
            }
            
            // Re-enable form
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
          })
          .catch(error => {
            console.error('Error:', error);
            
            // Update status
            document.getElementById('statusMessage').textContent = 'CONNECTION ERROR';
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('progress-text').textContent = 'FAILED';
            
            addConsoleMessage(`> SYSTEM ERROR: ${error.message}`, 'share-error');
            addConsoleMessage('> CONNECTION TERMINATED', 'share-error');
            
            // Re-enable form
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText;
          });
        }, 1000);
      });
    });
    
    // Function to add messages to the console with typing effect
    function addConsoleMessage(message, type) {
      const consoleContainer = document.getElementById('console-container');
      const messageElement = document.createElement('div');
      messageElement.className = `console-line ${type}`;
      
      consoleContainer.appendChild(messageElement);
      consoleContainer.scrollTop = consoleContainer.scrollHeight;
      
      // Add typing effect
      let i = 0;
      const typingSpeed = 10; // Adjust for faster/slower typing
      
      function typeText() {
        if (i < message.length) {
          messageElement.textContent += message.charAt(i);
          i++;
          setTimeout(typeText, typingSpeed);
        }
        consoleContainer.scrollTop = consoleContainer.scrollHeight;
      }
      
      typeText();
    }
    
    // Extract post ID from URL
    function extractPostId(url) {
      try {
        // Try to extract post ID, but if we can't, just return "uid_postid"
        // This is just for display purposes in the console
        return "uid_postid";
      } catch (e) {
        return "uid_postid";
      }
    }
  });
</script>
{% endblock %}